'use strict';
var _typeof = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (obj) {
    return typeof obj;
} : function (obj) {
    return obj && typeof Symbol === 'function' && obj.constructor === Symbol && obj !== Symbol.prototype ? 'symbol' : typeof obj;
};
(function (factory) {
    if (true) {
        module.exports = factory(require('jquery'));
    }
}(function ($) {
    var menu, shadow, trigger, content, hash, currentTarget;
    var _defaults = {
        menuStyle: {
            listStyle: 'none',
            padding: '1px',
            margin: '0px',
            backgroundColor: '#fff',
            border: '1px solid #999',
            width: '100px'
        },
        itemStyle: {
            margin: '0px',
            color: '#000',
            display: 'block',
            cursor: 'default',
            padding: '3px',
            border: '1px solid #fff',
            backgroundColor: 'transparent'
        },
        itemHoverStyle: {
            border: '1px solid #0a246a',
            backgroundColor: '#b6bdd2'
        },
        eventPosX: 'pageX',
        eventPosY: 'pageY',
        shadow: true,
        onContextMenu: null,
        onShowMenu: null
    };
    $.fn.contextMenu = function (id, options) {
        var el = options.el || document.body;
        if (!menu) {
            menu = $('<div id="jqContextMenu"></div>').hide().css({
                position: 'absolute',
                zIndex: '500'
            }).appendTo(el).bind('click', function (e) {
                e.stopPropagation();
            });
        }
        if (!shadow) {
            shadow = $('<div></div>').css({
                backgroundColor: '#000',
                position: 'absolute',
                opacity: 0.2,
                zIndex: 499
            }).appendTo(el).hide();
        }
        hash = hash || [];
        hash.push({
            id: id,
            menuStyle: $.extend({}, _defaults.menuStyle, options.menuStyle || {}),
            itemStyle: $.extend({}, _defaults.itemStyle, options.itemStyle || {}),
            itemHoverStyle: $.extend({}, _defaults.itemHoverStyle, options.itemHoverStyle || {}),
            bindings: options.bindings || {},
            shadow: options.shadow || options.shadow === false ? options.shadow : _defaults.shadow,
            onContextMenu: options.onContextMenu || _defaults.onContextMenu,
            onShowMenu: options.onShowMenu || _defaults.onShowMenu,
            eventPosX: options.eventPosX || _defaults.eventPosX,
            eventPosY: options.eventPosY || _defaults.eventPosY
        });
        var index = hash.length - 1;
        $(this).bind('contextmenu', function (e) {
            var bShowContext = !!hash[index].onContextMenu ? hash[index].onContextMenu(e) : true;
            if (bShowContext)
                display(index, this, e, options);
            return false;
        });
        return this;
    };
    function display(index, trigger, e, options) {
        var cur = hash[index];
        content = $('#' + cur.id).find('ul:first').clone(true);
        content.css(cur.menuStyle).find('li').css(cur.itemStyle).hover(function () {
            $(this).css(cur.itemHoverStyle);
        }, function () {
            $(this).css(cur.itemStyle);
        }).find('img').css({
            verticalAlign: 'middle',
            paddingRight: '2px'
        });
        menu.html(content);
        if (!!cur.onShowMenu)
            menu = cur.onShowMenu(e, menu);
        $.each(cur.bindings, function (id, func) {
            $('#' + id, menu).bind('click', function (e) {
                hide();
                func(trigger, currentTarget);
            });
        });
        menu.css({
            'left': e[cur.eventPosX],
            'top': e[cur.eventPosY]
        }).show();
        if (cur.shadow)
            shadow.css({
                width: menu.width(),
                height: menu.height(),
                left: e.pageX + 2,
                top: e.pageY + 2
            }).show();
        $(document).one('click', hide);
    }
    function hide() {
        menu.hide();
        shadow.hide();
    }
    $.contextMenu = {
        defaults: function defaults(userDefaults) {
            $.each(userDefaults, function (i, val) {
                if ((typeof val === 'undefined' ? 'undefined' : _typeof(val)) == 'object' && _defaults[i]) {
                    $.extend(_defaults[i], val);
                } else
                    _defaults[i] = val;
            });
        }
    };
    $(function () {
        $('div.contextMenu').hide();
    });
}));